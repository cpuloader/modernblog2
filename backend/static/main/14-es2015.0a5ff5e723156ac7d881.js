(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{adav:function(l,e,n){"use strict";n.r(e);var r=n("8Y7J"),t=n("IheW"),s=n("FFoR"),i=n("PWx8"),u=n("7dP1"),o=n("il7l"),a=n("52Ma");class p{constructor(l,e,n,r,t,s,i,u,o){this.postsService=l,this.profileService=e,this.authService=n,this.chatService=r,this.config=t,this.route=s,this.router=i,this.renderer=u,this.translate=o,this.nextPage=0,this.profileAvatar=this.config.profilePlaceholder()}getProfilePosts(){this.profile&&this.postsService.getAuthorPosts(this.profile.username,this.nextPage).subscribe(l=>{this.profilePosts=l.results,this.loaded=!0,this.nextPage=+l.next},l=>console.log(l))}loadMore(){this.postsService.getAuthorPosts(this.profile.username,this.nextPage).subscribe(l=>{let e;e=(e=this.profilePosts.slice(0)).concat(l.results),this.profilePosts=e,this.nextPage=+l.next},l=>console.log(l))}updateAvatar(l){this.error="";let e=l.target.files[0];if(!e)return;let n=e.name.toLowerCase();-1!=n.lastIndexOf("jpg")||-1!=n.lastIndexOf("jpeg")||-1!=n.lastIndexOf("gif")||-1!=n.lastIndexOf("png")?e.size&&e.size>6291456?this.translate.get("ERRORS.BIGFILE").subscribe(l=>{this.error=l}):this.avatarUpdater=this.profileService.updateAvatar(e).subscribe(l=>{if(l.type===t.f.UploadProgress){const e=Math.round(100*l.loaded/l.total);this.progressBarShow(e)}else if(l instanceof t.j)if(201==l.status)this.profile.avatarimage=l.body,this.makeAvatar(),this.authService.setMeToStorage(this.profile);else try{this.error=l.body.error.error}catch(e){this.translate.get("ERRORS.ERROR").subscribe(l=>{this.error=l})}},l=>{this.error="Error!"},()=>this.avatarUpdater.unsubscribe()):this.translate.get("ERRORS.WRONGTYPE").subscribe(l=>{this.error=l})}progressBarShow(l){this.renderer.setStyle(this.avaProgressBar.nativeElement,"display","block"),this.renderer.setStyle(this.avaProgress.nativeElement,"width",l.toString()+"%"),this.renderer.setAttribute(this.avaProgress.nativeElement,"aria-valuenow",l.toString()),100==l&&this.renderer.setStyle(this.avaProgressBar.nativeElement,"display","none")}makeAvatar(){this.profileAvatar=this.profile.avatarimage?{backgroundImage:"url("+this.profile.avatarimage.picture_for_profile+")"}:this.config.profilePlaceholder()}ngOnInit(){this.loggedAuthor=this.authService.getMe(),this.loggedAuthor||this.router.navigateByUrl("/page404"),this.profileService.getAuthor(this.loggedAuthor.username).subscribe(l=>{this.profile=l,this.authService.loggedAuthor=l,this.makeAvatar(),this.getProfilePosts()},l=>{l.error&&"Not found."===l.error.detail&&this.router.navigateByUrl("/page404")}),this.postsSubscription=this.postsService.onePost$.subscribe(l=>{if(l)for(let e=0;this.profilePosts.length;e++)if(l.id==this.profilePosts[e].id){let l=this.profilePosts.slice(0);return l.splice(e,1),this.profilePosts=l,void(this.postsService.onePost=null)}})}ngOnDestroy(){this.postsSubscription.unsubscribe(),this.avatarUpdater&&this.avatarUpdater.unsubscribe()}}class g{}var c=n("pMnS"),b=n("SVse"),f=n("zLBW"),h=n("lYM4"),d=n("VSxx"),v=n("iInd"),P=n("TSSN"),m=r.nb({encapsulation:0,styles:[[".user-profile-page_username[_ngcontent-%COMP%]{display:inline}.user-profile-page_online[_ngcontent-%COMP%]{color:#32cd32;display:inline}.user-profile-page_tagline[_ngcontent-%COMP%]{font-style:italic}.user-profile-page_avatar-progress[_ngcontent-%COMP%]{position:relative}.user-profile-page_deactivated[_ngcontent-%COMP%]{color:#f44336;display:inline}.user-profile-page_profile-avatar[_ngcontent-%COMP%]{position:relative;display:block;width:300px;height:300px;background-position:center;background-repeat:no-repeat;background-size:cover}.user-profile-page_avatar-image-input[_ngcontent-%COMP%]{top:240px;left:70px;font-size:12px;z-index:10}.user-profile-page_image-button[_ngcontent-%COMP%]{color:#fff;font-size:12px}.user-profile-page_image-error[_ngcontent-%COMP%]{width:300px}.user-profile-page_load-more[_ngcontent-%COMP%], .user-profile-page_loading-posts[_ngcontent-%COMP%]{text-align:center}#profile-progress-bar[_ngcontent-%COMP%]{position:absolute;left:0;top:290px;width:300px;height:10px;z-index:10;display:none}"]],data:{}});function _(l){return r.Jb(0,[(l()(),r.pb(0,0,null,null,1,"p",[["class","user-profile-page_deactivated"]],null,null,null,null,null)),(l()(),r.Hb(-1,null,["DEACTIVATED"]))],null,null)}function S(l){return r.Jb(0,[(l()(),r.pb(0,0,null,null,1,"p",[["class","user-profile-page_online"]],null,null,null,null,null)),(l()(),r.Hb(-1,null,["Online"]))],null,null)}function x(l){return r.Jb(0,[(l()(),r.pb(0,0,null,null,1,"button",[["class","btn btn-raised"],["type","button"]],null,[[null,"click"]],function(l,e,n){var r=!0;return"click"===e&&(r=!1!==l.component.loadMore()&&r),r},null,null)),(l()(),r.Hb(-1,null,["Load more..."]))],null,null)}function z(l){return r.Jb(0,[(l()(),r.pb(0,0,null,null,29,"div",[["class","user-profile-page"]],null,null,null,null,null)),(l()(),r.pb(1,0,null,null,20,"div",[["class","jumbotron"]],null,null,null,null,null)),(l()(),r.pb(2,0,null,null,1,"h2",[["class","user-profile-page_username"]],null,null,null,null,null)),(l()(),r.Hb(3,null,["","\u2002"])),(l()(),r.eb(16777216,null,null,1,null,_)),r.ob(5,16384,null,0,b.j,[r.M,r.J],{ngIf:[0,"ngIf"]},null),(l()(),r.eb(16777216,null,null,1,null,S)),r.ob(7,16384,null,0,b.j,[r.M,r.J],{ngIf:[0,"ngIf"]},null),(l()(),r.pb(8,0,null,null,1,"p",[["class","user-profile-page_tagline"]],null,null,null,null,null)),(l()(),r.Hb(9,null,["",""])),(l()(),r.pb(10,0,null,null,11,"div",[["class","user-profile-page_avatar-progress"]],null,null,null,null,null)),(l()(),r.pb(11,0,[[1,0],["avaprogressbar",1]],null,1,"div",[["class","progress"],["id","profile-progress-bar"]],null,null,null,null,null)),(l()(),r.pb(12,0,[[2,0],["avaprogress",1]],null,0,"div",[["aria-valuemax","100"],["aria-valuemin","0"],["aria-valuenow","0"],["class","progress-bar progress-bar-success progress-bar-striped"],["id","progress"],["role","progressbar"],["style","width: 0%"]],null,null,null,null,null)),(l()(),r.pb(13,0,null,null,3,"div",[["class","btn btn-file user-profile-page_avatar-image-input"]],null,null,null,null,null)),(l()(),r.pb(14,0,null,null,1,"span",[["class","user-profile-page_image-button"]],null,null,null,null,null)),(l()(),r.Hb(-1,null,["Change picture"])),(l()(),r.pb(16,0,null,null,0,"input",[["accept","image/*"],["type","file"]],null,[[null,"change"]],function(l,e,n){var r=!0;return"change"===e&&(r=!1!==l.component.updateAvatar(n)&&r),r},null,null)),(l()(),r.pb(17,0,null,null,2,"div",[["class","user-profile-page_profile-avatar"]],null,null,null,null,null)),r.Eb(512,null,b.u,b.v,[r.k,r.r,r.B]),r.ob(19,278528,null,0,b.m,[b.u],{ngStyle:[0,"ngStyle"]},null),(l()(),r.pb(20,0,null,null,1,"div",[["class","alert alert-danger user-profile-page_image-error"]],[[8,"hidden",0]],null,null,null,null)),(l()(),r.Hb(21,null,["",""])),(l()(),r.pb(22,0,null,null,1,"div",[["class","user-profile-page_loading-posts"]],[[8,"hidden",0]],null,null,null,null)),(l()(),r.Hb(-1,null,["Loading posts..."])),(l()(),r.pb(24,0,null,null,2,"span",[],[[8,"hidden",0]],null,null,null,null)),(l()(),r.pb(25,0,null,null,1,"posts",[],null,null,null,f.b,f.a)),r.ob(26,573440,null,0,h.a,[d.a,i.a,u.a],{loggedAuthor:[0,"loggedAuthor"],posts:[1,"posts"]},null),(l()(),r.pb(27,0,null,null,2,"div",[["class","user-profile-page_load-more"]],null,null,null,null,null)),(l()(),r.eb(16777216,null,null,1,null,x)),r.ob(29,16384,null,0,b.j,[r.M,r.J],{ngIf:[0,"ngIf"]},null)],function(l,e){var n=e.component;l(e,5,0,!n.profile.enabled),l(e,7,0,n.profile.is_online),l(e,19,0,n.profileAvatar),l(e,26,0,n.loggedAuthor,n.profilePosts),l(e,29,0,n.nextPage)},function(l,e){var n=e.component;l(e,3,0,n.profile.username),l(e,9,0,n.profile.tagline),l(e,20,0,!n.error),l(e,21,0,n.error),l(e,22,0,n.loaded),l(e,24,0,!n.loaded)})}function y(l){return r.Jb(0,[r.Fb(671088640,1,{avaProgressBar:0}),r.Fb(671088640,2,{avaProgress:0}),(l()(),r.eb(16777216,null,null,1,null,z)),r.ob(3,16384,null,0,b.j,[r.M,r.J],{ngIf:[0,"ngIf"]},null)],function(l,e){l(e,3,0,!!e.component.profile)},null)}function M(l){return r.Jb(0,[(l()(),r.pb(0,0,null,null,1,"user-profile-sel",[],null,null,null,y,m)),r.ob(1,245760,null,0,p,[i.a,s.a,u.a,o.a,a.a,v.a,v.k,r.B,P.k],null,null)],function(l,e){l(e,1,0)},null)}var O=r.lb("user-profile-sel",p,M,{},{},[]),A=n("s7LF"),k=n("Xu7E"),I=n("PCNd");n.d(e,"UserProfileModuleNgFactory",function(){return w});var w=r.mb(g,[],function(l){return r.yb([r.zb(512,r.j,r.X,[[8,[c.a,O]],[3,r.j],r.v]),r.zb(4608,b.l,b.k,[r.s,[2,b.x]]),r.zb(4608,A.o,A.o,[]),r.zb(5120,P.g,k.a,[t.c]),r.zb(4608,P.c,P.f,[]),r.zb(4608,P.i,P.d,[]),r.zb(4608,P.b,P.a,[]),r.zb(4608,P.k,P.k,[P.l,P.g,P.c,P.i,P.b,P.m,P.n]),r.zb(1073742336,b.b,b.b,[]),r.zb(1073742336,v.m,v.m,[[2,v.r],[2,v.k]]),r.zb(1073742336,A.n,A.n,[]),r.zb(1073742336,A.d,A.d,[]),r.zb(1073742336,P.h,P.h,[]),r.zb(1073742336,k.b,k.b,[]),r.zb(1073742336,I.a,I.a,[]),r.zb(1073742336,g,g,[]),r.zb(256,P.n,void 0,[]),r.zb(256,P.m,void 0,[]),r.zb(1024,v.i,function(){return[[{path:"",component:p}]]},[])])})}}]);