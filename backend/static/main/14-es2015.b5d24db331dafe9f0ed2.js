(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{adav:function(l,e,n){"use strict";n.r(e);var t=n("8Y7J"),r=n("IheW"),s=n("FFoR"),i=n("PWx8"),u=n("7dP1"),a=n("il7l"),o=n("52Ma");class p{constructor(l,e,n,t,r,s,i,u,a){this.postsService=l,this.profileService=e,this.authService=n,this.chatService=t,this.config=r,this.route=s,this.router=i,this.renderer=u,this.translate=a,this.nextPage=0,this.converting=!1,this.avatarUploading=!1,this.profileAvatar=this.config.profilePlaceholder()}getProfilePosts(){this.profile&&this.postsService.getAuthorPosts(this.profile.username,this.nextPage).subscribe(l=>{this.profilePosts=l.results,this.loaded=!0,this.nextPage=+l.next},l=>console.log(l))}loadMore(){this.postsService.getAuthorPosts(this.profile.username,this.nextPage).subscribe(l=>{let e;e=(e=this.profilePosts.slice(0)).concat(l.results),this.profilePosts=e,this.nextPage=+l.next},l=>console.log(l))}updateAvatar(l){if(this.error="",this.converting=!1,this.avatarUploading)return;this.avatarUploading=!0;let e=l.target.files[0];if(!e)return;let n=e.name.toLowerCase();-1!=n.lastIndexOf("jpg")||-1!=n.lastIndexOf("jpeg")||-1!=n.lastIndexOf("gif")||-1!=n.lastIndexOf("png")?e.size&&e.size>6291456?this.translate.get("ERRORS.BIGFILE").subscribe(l=>{this.error=l}):this.avatarUpdater=this.profileService.updateAvatar(e).subscribe(l=>{if(l.type===r.f.UploadProgress){const e=Math.round(100*l.loaded/l.total);this.progressBarShow(e)}else if(l instanceof r.j){if(201==l.status)this.profile.avatarimage=l.body,this.loggedAuthor=this.profile,this.makeAvatar(),this.authService.setMeToStorage(this.profile);else try{this.error=l.body.error.error}catch(e){this.translate.get("ERRORS.ERROR").subscribe(l=>{this.error=l})}this.converting=!1,this.avatarUploading=!1}},l=>{this.error="Error!",this.converting=!1,this.avatarUploading=!1},()=>this.avatarUpdater.unsubscribe()):this.translate.get("ERRORS.WRONGTYPE").subscribe(l=>{this.error=l})}progressBarShow(l){this.renderer.setStyle(this.avaProgressBar.nativeElement,"display","block"),this.renderer.setStyle(this.avaProgress.nativeElement,"width",l.toString()+"%"),this.renderer.setAttribute(this.avaProgress.nativeElement,"aria-valuenow",l.toString()),100==l&&(this.renderer.setStyle(this.avaProgressBar.nativeElement,"display","none"),this.converting=!0)}makeAvatar(){this.profileAvatar=this.profile.avatarimage?{backgroundImage:"url("+this.profile.avatarimage.picture_for_profile+")"}:this.config.profilePlaceholder()}ngOnInit(){this.loggedAuthor=this.authService.getMe(),this.loggedAuthor||this.router.navigateByUrl("/page404"),this.profileService.getAuthor(this.loggedAuthor.username).subscribe(l=>{this.profile=l,this.authService.loggedAuthor=l,this.makeAvatar(),this.getProfilePosts()},l=>{l.error&&"Not found."===l.error.detail&&this.router.navigateByUrl("/page404")}),this.postsSubscription=this.postsService.onePost$.subscribe(l=>{if(l)for(let e=0;this.profilePosts.length;e++)if(l.id==this.profilePosts[e].id){let l=this.profilePosts.slice(0);return l.splice(e,1),this.profilePosts=l,void(this.postsService.onePost=null)}})}ngOnDestroy(){this.postsSubscription.unsubscribe(),this.avatarUpdater&&this.avatarUpdater.unsubscribe()}}class g{}var c=n("pMnS"),b=n("TSSN"),h=n("SVse"),f=n("zLBW"),d=n("lYM4"),v=n("VSxx"),P=n("iInd"),m=t.nb({encapsulation:0,styles:[[".user-profile-page_username[_ngcontent-%COMP%]{display:inline}.user-profile-page_online[_ngcontent-%COMP%]{color:#32cd32;display:inline}.user-profile-page_tagline[_ngcontent-%COMP%]{font-style:italic}.user-profile-page_avatar-progress[_ngcontent-%COMP%]{position:relative}.user-profile-page_deactivated[_ngcontent-%COMP%]{color:#f44336;display:inline}.user-profile-page_profile-avatar[_ngcontent-%COMP%]{position:relative;display:block;width:300px;height:300px;background-position:center;background-repeat:no-repeat;background-size:cover}.user-profile-page_avatar-image-input[_ngcontent-%COMP%]{top:240px;left:70px;font-size:12px;z-index:10}.user-profile-page_image-button[_ngcontent-%COMP%]{color:#fff;font-size:12px}.user-profile-page_image-error[_ngcontent-%COMP%], .user-profile-page_image-status[_ngcontent-%COMP%]{width:300px}.user-profile-page_load-more[_ngcontent-%COMP%], .user-profile-page_loading-posts[_ngcontent-%COMP%]{text-align:center}#profile-progress-bar[_ngcontent-%COMP%]{position:absolute;left:0;top:290px;width:300px;height:10px;z-index:10;display:none}"]],data:{}});function _(l){return t.Jb(0,[(l()(),t.pb(0,0,null,null,1,"p",[["class","user-profile-page_deactivated"]],null,null,null,null,null)),(l()(),t.Hb(-1,null,["DEACTIVATED"]))],null,null)}function S(l){return t.Jb(0,[(l()(),t.pb(0,0,null,null,1,"p",[["class","user-profile-page_online"]],null,null,null,null,null)),(l()(),t.Hb(-1,null,["Online"]))],null,null)}function A(l){return t.Jb(0,[(l()(),t.pb(0,0,null,null,3,"button",[["class","btn btn-raised"],["type","button"]],null,[[null,"click"]],function(l,e,n){var t=!0;return"click"===e&&(t=!1!==l.component.loadMore()&&t),t},null,null)),(l()(),t.pb(1,0,null,null,2,"span",[],null,null,null,null,null)),t.ob(2,8536064,null,0,b.e,[b.k,t.k,t.h],{translate:[0,"translate"]},null),(l()(),t.Hb(-1,null,["Load more"]))],function(l,e){l(e,2,0,"BUTTON.LOADMORE")},null)}function O(l){return t.Jb(0,[(l()(),t.pb(0,0,null,null,36,"div",[["class","user-profile-page"]],null,null,null,null,null)),(l()(),t.pb(1,0,null,null,25,"div",[["class","jumbotron"]],null,null,null,null,null)),(l()(),t.pb(2,0,null,null,1,"h2",[["class","user-profile-page_username"]],null,null,null,null,null)),(l()(),t.Hb(3,null,["","\u2002"])),(l()(),t.eb(16777216,null,null,1,null,_)),t.ob(5,16384,null,0,h.j,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(l()(),t.eb(16777216,null,null,1,null,S)),t.ob(7,16384,null,0,h.j,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(l()(),t.pb(8,0,null,null,1,"p",[["class","user-profile-page_tagline"]],null,null,null,null,null)),(l()(),t.Hb(9,null,["",""])),(l()(),t.pb(10,0,null,null,16,"div",[["class","user-profile-page_avatar-progress"]],null,null,null,null,null)),(l()(),t.pb(11,0,[[1,0],["avaprogressbar",1]],null,1,"div",[["class","progress"],["id","profile-progress-bar"]],null,null,null,null,null)),(l()(),t.pb(12,0,[[2,0],["avaprogress",1]],null,0,"div",[["aria-valuemax","100"],["aria-valuemin","0"],["aria-valuenow","0"],["class","progress-bar progress-bar-success progress-bar-striped"],["id","progress"],["role","progressbar"],["style","width: 0%"]],null,null,null,null,null)),(l()(),t.pb(13,0,null,null,4,"div",[["class","btn btn-file user-profile-page_avatar-image-input"]],null,null,null,null,null)),(l()(),t.pb(14,0,null,null,2,"span",[["class","user-profile-page_image-button"]],null,null,null,null,null)),t.ob(15,8536064,null,0,b.e,[b.k,t.k,t.h],{translate:[0,"translate"]},null),(l()(),t.Hb(-1,null,["Change picture"])),(l()(),t.pb(17,0,null,null,0,"input",[["accept","image/*"],["type","file"]],null,[[null,"change"]],function(l,e,n){var t=!0;return"change"===e&&(t=!1!==l.component.updateAvatar(n)&&t),t},null,null)),(l()(),t.pb(18,0,null,null,2,"div",[["class","user-profile-page_profile-avatar"]],null,null,null,null,null)),t.Eb(512,null,h.u,h.v,[t.k,t.r,t.B]),t.ob(20,278528,null,0,h.m,[h.u],{ngStyle:[0,"ngStyle"]},null),(l()(),t.pb(21,0,null,null,1,"div",[["class","alert alert-danger user-profile-page_image-error"]],[[8,"hidden",0]],null,null,null,null)),(l()(),t.Hb(22,null,["",""])),(l()(),t.pb(23,0,null,null,3,"div",[["class","alert alert-info user-profile-page_image-status"]],[[8,"hidden",0]],null,null,null,null)),(l()(),t.pb(24,0,null,null,2,"span",[],null,null,null,null,null)),t.ob(25,8536064,null,0,b.e,[b.k,t.k,t.h],{translate:[0,"translate"]},null),(l()(),t.Hb(-1,null,["Preparing..."])),(l()(),t.pb(27,0,null,null,3,"div",[["class","user-profile-page_loading-posts"]],[[8,"hidden",0]],null,null,null,null)),(l()(),t.pb(28,0,null,null,2,"span",[],null,null,null,null,null)),t.ob(29,8536064,null,0,b.e,[b.k,t.k,t.h],{translate:[0,"translate"]},null),(l()(),t.Hb(-1,null,["Loading posts..."])),(l()(),t.pb(31,0,null,null,2,"span",[],[[8,"hidden",0]],null,null,null,null)),(l()(),t.pb(32,0,null,null,1,"posts",[],null,null,null,f.b,f.a)),t.ob(33,573440,null,0,d.a,[v.a,i.a,u.a],{loggedAuthor:[0,"loggedAuthor"],posts:[1,"posts"]},null),(l()(),t.pb(34,0,null,null,2,"div",[["class","user-profile-page_load-more"]],null,null,null,null,null)),(l()(),t.eb(16777216,null,null,1,null,A)),t.ob(36,16384,null,0,h.j,[t.M,t.J],{ngIf:[0,"ngIf"]},null)],function(l,e){var n=e.component;l(e,5,0,!n.profile.enabled),l(e,7,0,n.profile.is_online),l(e,15,0,"BUTTON.CHANGEAVATAR"),l(e,20,0,n.profileAvatar),l(e,25,0,"USERPROFILEPAGE.AVATARCONVERTING"),l(e,29,0,"USERPROFILEPAGE.LOADING.POSTS"),l(e,33,0,n.loggedAuthor,n.profilePosts),l(e,36,0,n.nextPage)},function(l,e){var n=e.component;l(e,3,0,n.profile.username),l(e,9,0,n.profile.tagline),l(e,21,0,!n.error),l(e,22,0,n.error),l(e,23,0,!n.converting),l(e,27,0,n.loaded),l(e,31,0,!n.loaded)})}function x(l){return t.Jb(0,[t.Fb(671088640,1,{avaProgressBar:0}),t.Fb(671088640,2,{avaProgress:0}),(l()(),t.eb(16777216,null,null,1,null,O)),t.ob(3,16384,null,0,h.j,[t.M,t.J],{ngIf:[0,"ngIf"]},null)],function(l,e){l(e,3,0,!!e.component.profile)},null)}function k(l){return t.Jb(0,[(l()(),t.pb(0,0,null,null,1,"user-profile-sel",[],null,null,null,x,m)),t.ob(1,245760,null,0,p,[i.a,s.a,u.a,a.a,o.a,P.a,P.k,t.B,b.k],null,null)],function(l,e){l(e,1,0)},null)}var z=t.lb("user-profile-sel",p,k,{},{},[]),M=n("s7LF"),y=n("Xu7E"),E=n("PCNd");n.d(e,"UserProfileModuleNgFactory",function(){return I});var I=t.mb(g,[],function(l){return t.yb([t.zb(512,t.j,t.X,[[8,[c.a,z]],[3,t.j],t.v]),t.zb(4608,h.l,h.k,[t.s,[2,h.x]]),t.zb(4608,M.o,M.o,[]),t.zb(5120,b.g,y.a,[r.c]),t.zb(4608,b.c,b.f,[]),t.zb(4608,b.i,b.d,[]),t.zb(4608,b.b,b.a,[]),t.zb(4608,b.k,b.k,[b.l,b.g,b.c,b.i,b.b,b.m,b.n]),t.zb(1073742336,h.b,h.b,[]),t.zb(1073742336,P.m,P.m,[[2,P.r],[2,P.k]]),t.zb(1073742336,M.n,M.n,[]),t.zb(1073742336,M.d,M.d,[]),t.zb(1073742336,b.h,b.h,[]),t.zb(1073742336,y.b,y.b,[]),t.zb(1073742336,E.a,E.a,[]),t.zb(1073742336,g,g,[]),t.zb(256,b.n,void 0,[]),t.zb(256,b.m,void 0,[]),t.zb(1024,P.i,function(){return[[{path:"",component:p}]]},[])])})}}]);